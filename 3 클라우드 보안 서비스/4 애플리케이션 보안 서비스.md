# 애플리케이션 보안 서비스
- 애플리케이션 서비스의 확장성과 호환성을 확보해 클라우드의 특징을 최대화할 수 있는 구조로 설계한다.
- 애플리케이션의 보안을 위해 사용자가 접속하는 영역과 내부적으로 함수가 호출되는 영역, 소스코드의 취약점 영역에 대한 보안 대책을 수립해야 한다.

## 1. 웹방화벽(WAF)
- **웹방화벽**은 애플리케이션으로 전송되는 사용자 요청이 정상인지 판단하여 애플리케이션의 취약점 공격을 차단한다.
  - OSI 7계층 중에서 7계층의 트래픽 필터링을 담당한다.
  - 출발지와 목적지의 IP와 포트만을 검사하는 방화벽은 정상적인 웹서비스를 통해서 애플리케이션을 공격하는 경우 방어가 불가능하므로, 웹방화벽을 적용한다.
  - 웹방화벽은 외부로부터 전달된 사용자 요청 정보를 분석하여 악의적인 의도가 포함되었는지를 판단한다.
- 클라우드 환경에서 웹방화벽은 가장 외부에 위치하고, 들어오는 모든 트래픽을 수신한다.
  - 즉, 클라우드 환경에서 보호해야 할 자원의 앞단에 위치하고, 웹방화벽을 통과한 정상 트래픽만 클라우드 내부로 인바운드 된다.
  - 구체적으로 방화벽으로 통해 일차적으로 접근을 제어한 정상 패킷에 공격코드가 포함되어 있는지를 분석한다.
  - DDoS 공격과 같이 대용량의 패킷인 전달될 경우, 웹방화벽에 많은 부하가 발생되어 애플리케이션 처리 속도에 문제가 될 수 있다.
    - 따라서, 웹방화벽을 구성하는 경우에 DDoS 방어나 오토스케일링과 같은 가용성 보장 방안도 함께 고려해야 한다.
- 웹방화벽은 2가지 모드를 제공한다.
  - 웹방화벽을 적용할 때 가용성 분석을 위해 보통 6개월 정도는 **학습모드**로 공격 모니터링과 서비스 영향도 분석을 수행하고, 이후에 **운영모드**를 적용한다.
- 기존 온프레미스에서 웹방화벽은 구성 방식에 따라 **네트워크 기반 솔루션**과 **호스트 기반 솔루션**으로 구분할 수 있다.
  - 클라우드 환경에서는 뻐르게 변경되는 가상서버에 에이전트 프로그램을 설치하고 관리하기 어렵기 때문에 네트워크 기반 웹방화벽이 주로 사용되고 있다.
  - 네트워크 기반 웹방화벽은 설치 위치에 따라 사용자 단에서 공격을 파악해 **사용자 엣지단에 구성하는 방식**과 **클라우드의 로드밸런서에 구성하는 방식**으로 구분할 수 있다.
    - 사용자 엣지단에 구성하는 방식은 사용자에게 빠르게 콘텐츠를 배포하기 위한 **CDN 서버**에 웹방화벽을 구성하는 방식이다.
      - 사용자와 가까운 근거리에서 실시간으로 HTTP/HTTPS 트래픽에 대한 보안을 수행하며 클라우드 환경에서는 사용자에게 뻐르게 콘텐츠를 제공하기 위한 클라우드 서비스인 **프론트 서비스**에 적용할 수 있다.
      - 사용자의 근거리 네트워크에 위치한 웹방화벽은 분석해야 할 콘텐츠가 인터넷 망으로 분산되어 애플리케이션에 대한 공격이 클라우드에 도달하기 전에 차단된다.
      - 차단된 패킷은 사후 분섯을 위해 클라우드 스크러빙 센터 또는 샌드박스로 즉시 전송하게 구성할 수 있다.
    - 클라우드의 로드밸런서에 구성하는 방식은 클라우드의 애플리케이션 레벨인 ABL에서 인터넷 게이트웨이나 웹서버에 도달하기 전에 공격을 차단하고 내부 자원을 보호하게 된다.

## 2. API 보호 서비스
- **API**는 프로그렘들 간에 애플리케이션이나 서비스를 연결해주는 역할을 하는 인터페이스용 프로그램이다.
  - 최근에는 웹 기반 API 호출이 일반화되어 있다.
- API는 API Gateway라는 단일 접점에서 인증, 라우팅, 조정, 로깅과 미터링 등의 기능을 수행한다.
  - **인증**은 서비스를 요청하는 클라이언트를 인증하고 API 토큰을 생성/발급하는 기능이다.
  - **라우팅**은 사용자의 서비스 요청을 박아 해당 서비스를 제공하는 서버로 전달하는 기술로써 부하를 조절하여 로드밸런싱을 수행하고 메시지와 헤더 기반으로 요청 사항을 전달하는 기능이다.
  - **조정**은 API 요청 메시지를 받아 서비스 제공을 위해 API를 추가하거나 프로토콜을 변환하는 기능이다.
  - **로깅**과 **미터링**은 API 운영 상태를 모니터링하고 최적화하기 위해 호출 로그를 저장하고 호출 패턴을 분석하여 과금 처리하고 빅데이터와 연계하는 기능이다.
- API는 클라우드에 있는 자원을 브라우저나 모바일로 쉽게 호출해서 사용할 수 있도록 기능을 제공하는 만큼, 외부 공격과 내부 유출을 방지하는 보안과 제어가 필요하다.
  - API Gateway는 외부에서 호출되기 때문에 서비스 요청자가 인가된 사용자인지, 적합한 권한을 가진 사용자인지 판단하는 기능이 필요하다.
    - 인증 로직이나 권한 관리가 확인되지 않는 API가 오용될 수 있고, API에 취약한 소스코드가 있는 경우는 인증을 우회하거나 권한 없는 데이터에 접근할 수 있기 때문이다.
    - 가용성 측면에서는 API Gateway가 단일 접점으로 클라우드에 있는 다양한 서비스를 호출하기 때문에 API Gateway가 DDoS 공격으로 서비스 장애가 발생하면 모든 서비스가 중단될 수 있다.
      - API 호출 건수로 사용 비용이 청구될 경우 DDoS 공격은 클라우드를 사용하는기업에 막대한 비용을 발생시킬 수 있다.
  - API를 보호하기 위해 정보를 은닉하는 방법과 API 실행 중에 API 토큰 정보를 확인하는 등 API를 보호하는 서비스를 호활용할 수 있다.

## 3. 보안 감사
- 클라우드 환경에서도 기존 온프레미스에서 애플리케이션의 보안 강화를 위해 사용했던 솔루션을 적용할 수 있다.

### 3.1. 웹 스캐너
- **웹 스캐너**는 애플리케이션이 사용자에게 제공하는 웹 사이트에서 발생 가능한 취약점을 자동으로 점검해주는 솔루션이다.
  - 구버전의 웹서버에서 OWASP TOP 10을 탐지하는 데 효과적이다.
- 웹 스캐너 보안 서비스 활용 절차
    1. 보안 관리자가 웹 스캐너에 점검하고자 하는 클라우드의 정보를 입력한다.
    2. 웹 스캐너에서 오픈된 포트 정보와 소프트웨어 정보를 확인한다.
    3. 웹 스캐너에서 다양한 보안 취약점 공격을 수행한다.
    4. 웹 스캐너에서 보안 관리자에게 취약점을 전달한다.

### 3.2. 시큐어 코딩 점검
- **시큐어 코딩 점검**은 개발 단계 또는 완료 후에 소스코드상의 보안 취약점을 점검하는 것이다.
- 사전에 코딩 표준화 기준을 수립하고 취약한 함수나 비효율적인 코딩 방식을 사용하지 않도록 교육하고, 개발 단계에서 시큐어 코딩 방식을 적용하고 점검하여 관리적 측면에서 보안 프로세스를 수행해야 한다.
- 형상 관리나 소스코드가 커밋되는 자원을 대상으로 자동화된 시큐어 코딩 보안 서비스가 접목되어야 한다.
  - 즉, 개발자가 커밋한 소스코드 관리 서버를 대상으로 시큐어 코딩 점검을 수행하고, 보안 관리자는 해당 결과를 바탕으로 취약점을 해소해야 한다.